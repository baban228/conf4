# Документация по Ассемблеру

## Обзор
Эта программа представляет собой простой ассемблер, который читает файлы на языке ассемблера, анализирует их и выводит бинарный файл, представляющий программу. Она поддерживает ограниченный набор команд ассемблера, констант и операндов. Ассемблер преобразует предоставленный файл `.asm` в бинарный формат, который можно использовать для дальнейшей обработки или исполнения на виртуальной машине.

## Структура файлов

### Формат исходного файла (`.asm`)
Файл `.asm` должен следовать базовой структуре, описанной ниже:

1. **Объявление секций:**
   - Секция `.data`: используется для определения констант.
   - Секция `.text`: содержит инструкции программы.

   Пример:
   ```
   section .data
   CONSTANT_NAME TYPE VALUE
   section .text
   MOV operand1 operand2
   ADD operand1 operand2
   HALT
   ```

2. **Константы:**
   - Определяются в секции `.data`.
   - Константы могут иметь различные типы (например, байт `b` для байта или другой тип).
   
   Пример:
   ```
   CONSTANT_1 b 100
   CONSTANT_2 b 200
   ```

3. **Инструкции:**
   - Каждая строка содержит команду (например, `MOV`, `ADD`, `SUB` и т.д.), за которой следуют её операнды.
   - Операнды могут различаться в зависимости от команды и могут включать регистры или константы.
   
   Пример:
   ```
   MOV A, CONSTANT_1
   ADD A, CONSTANT_2
   ```

4. **Поддерживаемые команды:**
   Ассемблер поддерживает следующие команды:
   - `MOV`: переместить значение в регистр или память.
   - `LOAD`: загрузить значение в регистр.
   - `STORE`: сохранить значение из регистра в память.
   - `ADD`: сложить два значения.
   - `SUB`: вычесть два значения.
   - `JMP`: выполнить переход к указанной инструкции.
   - `JZ`: выполнить переход, если результат равен нулю.
   - `PUSH`: поместить значение в стек.
   - `POP`: извлечь значение из стека.
   - `HALT`: остановить выполнение программы.

## Класс Ассемблера

Ассемблер работает следующим образом: сначала он анализирует исходный файл `.asm`, извлекает инструкции и константы, а затем преобразует их в бинарный формат.

### Ключевые компоненты:
1. **Перечисления и структуры:**
   - **Перечисление команд:** определяет все возможные команды.
   - **Структура инструкции:** представляет инструкцию, состоящую из команды и двух операндов.
   - **Структура константы:** представляет константу с именем, типом и значением.

2. **Методы:**
   - **`parse_command`**: преобразует строковую команду в соответствующее перечисление `Command`.
   - **`parse_file`**: читает входной файл, обрабатывает секции и сохраняет инструкции и константы.
   - **`assemble`**: преобразует проанализированные инструкции и константы в бинарный формат и записывает их в файл.

### Основной процесс:
1. **Парсинг файла:**
   Файл анализируется построчно. Идентифицируются секции `.data` и `.text`, и извлекаются соответствующие константы и инструкции.
   
2. **Генерация ассемблерного кода:**
   После парсинга константы и инструкции записываются в бинарный файл (`program.bin`).

## Инструкции по компиляции

Чтобы скомпилировать программу, используйте следующую команду:

```
g++ -std=c++17 -o assembler assembler.cpp
```

## Использование

### Аргументы командной строки:
Ассемблер принимает один необязательный аргумент командной строки:

1. **Входной файл:**
   - Если файл не указан в аргументах командной строки, программа запросит у пользователя имя файла.
   - Файл должен иметь расширение `.asm`.

### Пример использования:
- Скомпилировать программу:
  ```
  g++ -std=c++17 -o assembler assembler.cpp
  ```

- Запустить программу:
  ```
  ./assembler example.asm
  ```

  или, если файл не указан:
  ```
  ./assembler
  ```
  Программа запросит имя входного файла.

### Выход:
Программа генерирует бинарный файл с именем `program.bin`, который содержит скомпилированное представление программы.

## Обработка ошибок
- Если входной файл не найден, программа выведет ошибку:
  ```
  No such file
  ```

- Если предоставлен неверный тип файла (например, не `.asm`), программа выведет ошибку:
  ```
  Not a .asm file
  ```

## Пример файла `.asm`

```asm
section .data
CONSTANT_1 b 100
CONSTANT_2 b 200

section .text
MOV A, CONSTANT_1
ADD A, CONSTANT_2
HALT
```

В этом примере `CONSTANT_1` и `CONSTANT_2` — это константы, определённые в секции `.data`, а в секции `.text` содержатся инструкции для перемещения значений в регистры, их сложения и остановки выполнения программы.

## Заключение

Этот ассемблер представляет собой простой инструмент для преобразования ассемблерного кода в бинарный код для исполнения на виртуальной машине или для дальнейшей обработки. Он поддерживает ограниченный набор команд и констант, но может быть расширен для поддержки дополнительного функционала.